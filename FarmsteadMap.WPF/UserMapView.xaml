<UserControl x:Class="FarmsteadMap.WPF.UserMapView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:FarmsteadMap.WPF"
             mc:Ignorable="d" 
             d:DesignHeight="720" d:DesignWidth="1280"
             Background="WhiteSmoke">

    <UserControl.Resources>
        <Style x:Key="ToolBarButton" TargetType="Button">
            <Setter Property="Background" Value="#F0F0F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E0E0E0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ZoomButton" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#AAA"/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Margin" Value="0, 2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="15">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F0F0F0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CategoryExpander" TargetType="Expander">
            <Setter Property="Background" Value="#F5F5F5"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <StackPanel>
                                <ToggleButton x:Name="HeaderSite" 
                                              Content="{TemplateBinding Header}"
                                              IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                                              FontWeight="SemiBold" FontSize="14" 
                                              Foreground="#444" Padding="10"
                                              Background="#FAFAFA"
                                              BorderThickness="0,0,0,1" BorderBrush="#EEE"/>
                                <ContentPresenter x:Name="ExpandSite" 
                                                  Visibility="Collapsed"
                                                  Margin="5"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ExpandSite" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="AssetItemTemplate">
            <StackPanel Orientation="Horizontal" Margin="2" ToolTip="{Binding Name}">
                <Image Source="{Binding Image}" Width="32" Height="32"/>
                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" Margin="5,0,0,0" MaxWidth="150" TextTrimming="CharacterEllipsis"/>
            </StackPanel>
        </DataTemplate>

        <Style x:Key="ToolButton" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#CCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style x:Key="LogoutButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#EEEEEE"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="ToolTip" Value="Ð’Ð¸Ð¹Ñ‚Ð¸ Ð· Ð°ÐºÐ°ÑƒÐ½Ñ‚Ñƒ"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="16">
                            <Path Data="M10,3.2V5.2H5V18.8H10V20.8H5C3.9,20.8 3,19.9 3,18.8V5.2C3,4.1 3.9,3.2 5,3.2H10M17.6,10.8L13.6,7L15.1,8.5L17,10.4H9V12.6H17L15.1,14.5L13.6,16L17.6,12.2L18,12L17.6,11.8L17.6,10.8Z"
                                  Fill="{TemplateBinding Foreground}"
                                  Stretch="Uniform"
                                  Margin="7"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Background" Value="#33FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Height="60" Background="#2C3E50">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0">
                    <Grid Width="32" Height="32">
                        <Border Background="White" CornerRadius="16" />
                        <Image Source="/Images/logo.png" Stretch="Uniform" />
                    </Grid>
                    <TextBlock Text="Farmstead Map" Foreground="White" FontSize="20" FontWeight="Bold" VerticalAlignment="Center" Margin="10,0,0,0"/>
                </StackPanel>
                <TextBlock x:Name="MapNameTextBlock" Grid.Column="1" Text="Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ Ð¼Ð°Ð¿Ð¸..." Foreground="White" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0">
                    <TextBlock x:Name="WelcomeTextBlock" Text="Ð’Ñ–Ñ‚Ð°Ñ”Ð¼Ð¾, ..." Foreground="#DDDDDD" FontSize="14" VerticalAlignment="Center"/>
                    <Button x:Name="LogoutButton" Style="{StaticResource LogoutButton}" Margin="15,0,0,0" Click="LogoutButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" Background="White">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="#F0F0F0" BorderBrush="#DDD" BorderThickness="0,0,1,1">
                    <StackPanel Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                        <Button Style="{StaticResource ToolBarButton}" Click="BackButton_Click" ToolTip="ÐŸÐ¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑŒ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð¼Ð°Ð¿">
                            <Path Data="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" Fill="#333" Width="24" Height="24"/>
                        </Button>
                        <Button Style="{StaticResource ToolBarButton}" Click="SaveButton_Click" ToolTip="Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ð¼Ð°Ð¿Ñƒ">
                            <Path Data="M17,3H5C3.89,3 3,3.9 3,5V19C3,20.1 3.89,21 5,21H19C20.1,21 21,20.1 21,19V7L17,3M19,19H5V5H16.17L19,7.83V19M12,12C10.34,12 9,13.34 9,15C9,16.66 10.34,18 12,18C13.66,18 15,16.66 15,15C15,13.34 13.66,12 12,12M6,6H15V10H6V6Z" Fill="#333" Width="24" Height="24"/>
                        </Button>
                        <Button Style="{StaticResource ToolBarButton}" ToolTip="Ð†Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ 'Ð ÑƒÐºÐ°' (ÐŸÐµÑ€ÐµÐ¼Ñ–Ñ‰ÐµÐ½Ð½Ñ)" Click="SelectTool_Click">
                            <Path Data="M13,6V11H18V7.5C18,6.67 17.33,6 16.5,6H13M13,13V18H16.5C17.33,18 18,17.33 18,16.5V13H13M11,13H6V16.5C6,17.33 6.67,18 7.5,18H11V13M11,6H7.5C6.67,6 6,6.67 6,7.5V11H11V6M4,12C4,10.34 5.34,9 7,9V4H9V9C10.66,9 12,10.34 12,12C12,13.66 10.66,15 9,15V20H7V15C5.34,15 4,13.66 4,12Z" Fill="#333" Width="24" Height="24"/>
                        </Button>
                    </StackPanel>
                </Border>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" BorderThickness="0,0,1,0" BorderBrush="#DDD">
                    <StackPanel>

                        <Expander Header="ðŸŽ¨ Ð›Ð°Ð½Ð´ÑˆÐ°Ñ„Ñ‚" Style="{StaticResource CategoryExpander}">
                            <StackPanel>
                                <Button Content="ÐœÐ°Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ð“Ð°Ð·Ð¾Ð½" Style="{StaticResource ToolButton}" Click="DrawAreaTool_Click" Tag="grass"/>
                                <Button Content="ÐœÐ°Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ð“Ñ€ÑÐ´ÐºÑƒ" Style="{StaticResource ToolButton}" Click="DrawAreaTool_Click" Tag="soil"/>
                                <Button Content="ÐœÐ°Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ð”Ð¾Ñ€Ñ–Ð¶ÐºÑƒ" Style="{StaticResource ToolButton}" Click="DrawAreaTool_Click" Tag="path"/>
                            </StackPanel>
                        </Expander>

                        <Expander Header="ðŸ¥• ÐžÐ²Ð¾Ñ‡Ñ–" Style="{StaticResource CategoryExpander}">
                            <ListBox x:Name="VegetablesListBox" ItemTemplate="{StaticResource AssetItemTemplate}" BorderThickness="0"
                                     PreviewMouseLeftButtonDown="AssetList_PreviewMouseLeftButtonDown"/>
                        </Expander>

                        <Expander Header="ðŸŒ¸ ÐšÐ²Ñ–Ñ‚Ð¸" Style="{StaticResource CategoryExpander}">
                            <ListBox x:Name="FlowersListBox" ItemTemplate="{StaticResource AssetItemTemplate}" BorderThickness="0"
                                     PreviewMouseLeftButtonDown="AssetList_PreviewMouseLeftButtonDown"/>
                        </Expander>

                        <Expander Header="ðŸŒ³ Ð”ÐµÑ€ÐµÐ²Ð°" Style="{StaticResource CategoryExpander}">
                            <ListBox x:Name="TreesListBox" ItemTemplate="{StaticResource AssetItemTemplate}" BorderThickness="0"
                                     PreviewMouseLeftButtonDown="AssetList_PreviewMouseLeftButtonDown"/>
                        </Expander>

                        <Expander Header="ðŸ  Ð‘ÑƒÐ´Ñ–Ð²Ð»Ñ–" Style="{StaticResource CategoryExpander}">
                            <ListBox x:Name="BuildingsListBox" ItemTemplate="{StaticResource AssetItemTemplate}" BorderThickness="0"
                                     PreviewMouseLeftButtonDown="AssetList_PreviewMouseLeftButtonDown"/>
                        </Expander>

                        <Expander Header="ðŸŒ¿ Ð”ÐµÐºÐ¾Ñ€Ð°Ñ†Ñ–Ñ—" Style="{StaticResource CategoryExpander}">
                            <ListBox x:Name="DecorationsListBox" ItemTemplate="{StaticResource AssetItemTemplate}" BorderThickness="0"
                                     PreviewMouseLeftButtonDown="AssetList_PreviewMouseLeftButtonDown"/>
                        </Expander>

                        <Expander Header="ðŸ“ Ð’Ñ–Ð´ÑÑ‚Ð°Ð½ÑŒ" Style="{StaticResource CategoryExpander}">
                            <StackPanel>
                                <Button Content="Ð†Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ 'Ð›Ñ–Ð½Ñ–Ð¹ÐºÐ°'" Style="{StaticResource ToolButton}" Click="RulerTool_Click"/>
                            </StackPanel>
                        </Expander>

                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <Grid Grid.Column="1" ClipToBounds="True" Background="#E0E0E0">

                <ScrollViewer x:Name="EditorScrollViewer" 
                              HorizontalScrollBarVisibility="Auto" 
                              VerticalScrollBarVisibility="Auto"
                              CanContentScroll="False">
                    <Border x:Name="CanvasBorder" Background="White" 
                            Width="2000" Height="2000">

                        <Grid x:Name="CanvasGridContainer">

                            <Canvas x:Name="LandscapeCanvas" Panel.ZIndex="0">
                                <Canvas.Background>
                                    <DrawingBrush Viewport="0,0,50,50" ViewportUnits="Absolute" TileMode="Tile">
                                        <DrawingBrush.Drawing>
                                            <GeometryDrawing>
                                                <GeometryDrawing.Geometry>
                                                    <GeometryGroup>
                                                        <LineGeometry StartPoint="0,0" EndPoint="50,0" />
                                                        <LineGeometry StartPoint="0,0" EndPoint="0,50" />
                                                    </GeometryGroup>
                                                </GeometryDrawing.Geometry>
                                                <GeometryDrawing.Pen>
                                                    <Pen Brush="#EEE" Thickness="1" />
                                                </GeometryDrawing.Pen>
                                            </GeometryDrawing>
                                        </DrawingBrush.Drawing>
                                    </DrawingBrush>
                                </Canvas.Background>
                            </Canvas>

                            <Canvas x:Name="ObjectCanvas" Panel.ZIndex="10" />

                            <Canvas x:Name="ToolCanvas" Panel.ZIndex="100" 
                                    Background="Transparent"
                                    AllowDrop="True"
                                    DragOver="ToolCanvas_DragOver"
                                    Drop="ToolCanvas_Drop"
                                    PreviewMouseLeftButtonDown="ToolCanvas_PreviewMouseLeftButtonDown"
                                    PreviewMouseMove="ToolCanvas_MouseMove"
                                    PreviewMouseLeftButtonUp="ToolCanvas_PreviewMouseLeftButtonUp"
                                    PreviewMouseRightButtonDown="ToolCanvas_PreviewMouseRightButtonDown"
                                    PreviewMouseWheel="ToolCanvas_PreviewMouseWheel"/>

                            <Grid.RenderTransform>
                                <ScaleTransform x:Name="CanvasScaleTransform" CenterX="0.5" CenterY="0.5"/>
                            </Grid.RenderTransform>

                        </Grid>
                    </Border>
                </ScrollViewer>

                <Border HorizontalAlignment="Left" VerticalAlignment="Bottom" 
                        Margin="20" Background="#AAFFFFFF" CornerRadius="5" Padding="10,5">
                    <StackPanel VerticalAlignment="Bottom" Margin="5,0,15,0">
                        <TextBlock x:Name="ScaleBarLabel" Text="5 m" FontSize="12" HorizontalAlignment="Center" FontWeight="SemiBold"/>
                        <Border x:Name="ScaleBar" Height="8" Width="100" Background="Black" BorderBrush="Black" BorderThickness="2" SnapsToDevicePixels="True"/>
                    </StackPanel>
                </Border>

                <Border HorizontalAlignment="Right" VerticalAlignment="Bottom" 
                        Margin="20" Background="#AAFFFFFF" CornerRadius="17" Padding="2">
                    <StackPanel Orientation="Vertical">
                        <Button x:Name="ZoomInButton" Content="+" Style="{StaticResource ZoomButton}" Click="ZoomInButton_Click"/>
                        <Button x:Name="ZoomOutButton" Content="-" Style="{StaticResource ZoomButton}" Click="ZoomOutButton_Click"/>
                    </StackPanel>
                </Border>

            </Grid>
        </Grid>
    </Grid>
</UserControl>
